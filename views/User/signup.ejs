<!DOCTYPE html>
<html lang="en">

<head>
    <%- include ('../partials/title-meta') %>

        <%- include ('../partials/head-css') %>
            <style>
                .error {
                    color: #dc3545;
                    /* Sets error text color to red */


                }
            </style>
</head>

<body class="authentication-bg position-relative">
    <div class="position-absolute start-0 end-0 start-0 bottom-0 w-100 h-100">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
            xmlns:svgjs="http://svgjs.com/svgjs" width="100%" height="100%" preserveAspectRatio="none"
            viewBox="0 0 1920 1024">
            <g mask="url(#SvgjsMask1046)" fill="none">
                <rect width="1920" height="1024" x="0" y="0" fill="url(#SvgjsLinearGradient1047)"></rect>
                <path d="M1920 0L1864.16 0L1920 132.5z" fill="rgba(255, 255, 255, .1)"></path>
                <path d="M1864.16 0L1920 132.5L1920 298.4L1038.6100000000001 0z" fill="rgba(255, 255, 255, .075)">
                </path>
                <path d="M1038.6100000000001 0L1920 298.4L1920 379.53999999999996L857.7000000000002 0z"
                    fill="rgba(255, 255, 255, .05)"></path>
                <path d="M857.7 0L1920 379.53999999999996L1920 678.01L514.57 0z" fill="rgba(255, 255, 255, .025)">
                </path>
                <path d="M0 1024L939.18 1024L0 780.91z" fill="rgba(0, 0, 0, .1)"></path>
                <path d="M0 780.91L939.18 1024L1259.96 1024L0 585.71z" fill="rgba(0, 0, 0, .075)"></path>
                <path d="M0 585.71L1259.96 1024L1426.79 1024L0 408.19000000000005z" fill="rgba(0, 0, 0, .05)"></path>
                <path d="M0 408.19000000000005L1426.79 1024L1519.6599999999999 1024L0 404.09000000000003z"
                    fill="rgba(0, 0, 0, .025)"></path>
            </g>
            <defs>
                <mask id="SvgjsMask1046">
                    <rect width="1920" height="1024" fill="#ffffff"></rect>
                </mask>
                <linearGradient x1="11.67%" y1="-21.87%" x2="88.33%" y2="121.88%" gradientUnits="userSpaceOnUse"
                    id="SvgjsLinearGradient1047">
                    <stop stop-color="#0c4b05" offset="0"></stop>
                    <stop stop-color="#5d8216" offset="1"></stop>
                </linearGradient>
            </defs>
        </svg>
    </div>
    <div class="account-pages pt-2 pt-sm-5 pb-4 pb-sm-5 position-relative">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xxl-8 col-lg-8">
                    <div class="card">

                        <!-- Logo -->
                        <div class="card-header pt-4 text-center">
                            <div class="auth-brand mb-0">
                                <a href="/" class="logo-dark">
                                    <span><img src="assets/images/cit_logo.png" alt="logo" height="65"></span>
                                    <span><img src="assets/images/logo.png" alt="dark logo" height="65"></span>
                                </a>
                                <a href="/" class="logo-light">
                                    <span><img src="assets/images/cit_logo.png" alt="logo" height="65"></span>
                                    <span><img src="assets/images/logo.png" alt="logo" height="65"></span>
                                </a>
                            </div>
                        </div>

                        <div class="card-body p-4">

                            <div class="text-center w-75 m-auto">
                                <h4 class="text-dark-50 text-center pb-0">Sign In</h4>
                                <p class="text-muted mb-4">Enter your username and password.</p>
                            </div>

                            <form action="/signup" method="post" enctype="multipart/form-data"
                                class="profile2-validation">

                                <div class="row push">


                                    <div class="col-lg-12">
                                        <p class="fs-sm text-muted">
                                            Please fill in the form below to create your personal details.
                                        </p>
                                        <!-- Name Field -->
                                        <div class="row">
                                            <div class="mb-3 col-md-4">
                                                <label for="firstname" class="form-label">First Name</label>
                                                <input type="text" class="form-control  " id="firstname"
                                                    name="firstname" placeholder="John" required>
                                            </div>
                                            <div class="mb-3 col-md-4">
                                                <label for="middlename" class="form-label">Middle Name</label>
                                                <input type="text" class="form-control  " id="middlename"
                                                    name="middlename" placeholder="Exa">
                                            </div>
                                            <div class="mb-3 col-md-4">


                                                <label for="lastname" class="form-label">Last Name</label>
                                                <input type="text" class="form-control  " id="lastname" name="lastname"
                                                    placeholder="Doe" required>
                                            </div>
                                        </div>

                                        <div class="row">

                                            <div class="mb-3 col-md-6">
                                                <label for="phonenumber" class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control  " id="phonenumber"
                                                    placeholder="09123456789" name="phonenumber" required>
                                            </div>
                                            <div class="mb-3 col-md-6">
                                                <label for="email" class="form-label">Email</label>
                                                <input type="email" class="form-control  " id="email" name="email"
                                                    placeholder="john.doe@example.com" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="mb-3 col-md-6">
                                                <label for="birthday" class="form-label">Birthday</label>
                                                <input type="date" class="form-control  " id="birthday" name="birthday"
                                                    required>
                                            </div>
                                            <div class="mb-3 col-md-6">
                                                <label for="gender" class="form-label">Gender</label>
                                                <select class="form-select " id="gender" name="gender" required>
                                                    <option value="" hidden>Choose...</option>
                                                    <option value="male">Male</option>
                                                    <option value="female">Female</option>
                                                    <option value="prefer-not-to-say">Prefer not to say</option>
                                                </select>
                                            </div>

                                        </div>



                                    </div>


                                    <div class="mb-3 col-md-6">
                                        <div class="mt-3 text-center">
                                            <img id="profile-image" src="/images/profile/default.jpg"
                                                alt="Profile Photo" class="img-avatar me-2"
                                                style="width: 150px; height: 150px;">
                                        </div>
                                        <label class="form-label" for="profile">Upload Profile Photo</label>
                                        <input class="form-control " type="file" id="profile" name="profile"
                                            accept="image/*" onchange="updateProfileImage(event)">
                                    </div>

                                    <div class="col-md-6">

                                        <div class="row">
                                            <div class="mb-3">
                                                <label for="username" class="form-label">Username</label>
                                                <input type="text" class="form-control " id="username" name="username"
                                                    placeholder="User" required>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="mb-3 col-md-12">
                                                <label for="password" class="form-label">Password</label>
                                                <input type="password" class="form-control  " id="password"
                                                    name="password" placeholder="********" required>
                                            </div>
                                            <div class="mb-3 col-md-12">
                                                <label for="confirm_password" class="form-label">Confirm
                                                    Password</label>
                                                <input type="password" class="form-control  " id="confirm_password"
                                                    name="confirm_password" placeholder="********" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div>
                                            <div class="form-check">
                                                <label class="form-check-label" for="agreement">
                                                    I have reviewed and agreed to the  <a type="button" class="" data-bs-toggle="modal"
                                                    data-bs-target="#privacyAct">
                                                    Data Privacy Act of 2012
                                                </a>
                                                </label>
                                                <input class="form-check-input" type="checkbox" name="agreement"
                                                    id="agreement" required>

                                            </div>
                                            <div class="modal fade" id="privacyAct" tabindex="-1"
                                            aria-labelledby="privacyActLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="privacyActLabel">
                                                            Data Privacy Act of 2012</h1>
                                                        <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <small class="text-muted mb-3">
                                                                By submitting this form, you agree to the collection and processing of your personal data in accordance with the policies of MMSU CIT Accreditation. This consent does not preclude the existence of other criteria for lawful processing of personal data and does not waive any rights under relevant data protection laws.
                                                            </small>
                                                        
                                                            <p>
                                                                I undertake to abide by the lawful processing of personal data as mandated by the provisions of the Data Privacy Act, its implementing rules and regulations, as well as the policies of MMSU CIT Accreditation. This includes compliance with the internal policies and any other applicable regulations.
                                                            </p>
                                                        </div>
                                                        
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close</button>

                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>

                                        <!-- Error message will appear here, below the checkbox -->
                                        <div class="error-message"></div>
                                    </div>


                                    <div class="row">
                                        <div class="mb-4">
                                            <button type="submit" class="btn btn-primary" id="submit-button">
                                                Create Account
                                                <span class="spinner-border spinner-border-sm" role="status"
                                                    aria-hidden="true" style="display: none;"></span>
                                            </button>
                                        </div>
                                    </div>


                                </div>

                            </form>
                        </div> <!-- end card-body -->
                    </div>
                    <!-- end card -->

                    <div class="row mt-3">
                        <div class="col-12 text-center">
                            <p class="text-white-50">Already have an account? <a href="/signin"
                                    class="text-white ms-1 link-offset-3 text-decoration-underline"><b>Sign
                                        In</b></a></p>
                        </div> <!-- end col -->
                    </div>
                    <!-- end row -->

                </div> <!-- end col -->
            </div>
            <!-- end row -->
        </div>
        <!-- end container -->
    </div>
    <!-- end page -->

    <footer class="footer footer-alt">
        <span class="text-white-50">
            <script>document.write(new Date().getFullYear())</script> © Accreditation
        </span>
    </footer>

    <%- include ('../partials/footer-scripts') %>

        <script>
            function updateProfileImage(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('profile-image').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }
        </script>
        <script src="/assets/js/lib/jquery.min.js"></script>

        <script src="/assets/js/plugins/jquery-validation/jquery.validate.min.js"></script>
        <script>
            !(function () {
                "use strict";
                class e {
                    static initValidation() {
                        // Initialize jQuery validation
                        jQuery(".profile2-validation").validate({
                            rules: {
                                firstname: {
                                    required: true,
                                    minlength: 2
                                },
                                middlename: {
                                    
                                    minlength: 2
                                },
                                lastname: {
                                    required: true,
                                    minlength: 2
                                },
                                gender: {
                                    required: true
                                },
                                birthday: {
                                    required: true,
                                    date: true
                                },
                                password: {
                                    required: true,
                                    minlength: 6
                                },
                                confirm_password: {
                                    required: true,
                                    equalTo: "#password"
                                },

                                profile: {
                                    required: true
                                },
                                agreement: {
                                    required: true
                                },
                                username: {
                                    required: true,
                                    minlength: 2,
                                    remote: {
                                        url: '/check-username',
                                        type: 'POST',
                                        data: {
                                            username: function () {
                                                return $("#username").val();
                                            },
                                            uuid: function () {
                                                return $("#uuid").val(); // Adjust based on your UUID input
                                            }
                                        },
                                        dataType: 'json',
                                        async: true,
                                        dataFilter: function (response) {
                                            var json = JSON.parse(response);
                                            return json.available ? "true" : "false";
                                        }
                                    }
                                },
                                email: {
                                    required: true,
                                    email: true,
                                    remote: {
                                        url: '/check-email',
                                        type: 'POST',
                                        data: {
                                            email: function () {
                                                return $("#email").val();
                                            },
                                            uuid: function () {
                                                return $("#uuid").val(); // Adjust based on your UUID input
                                            }
                                        },
                                        dataType: 'json',
                                        async: true,
                                        dataFilter: function (response) {
                                            var json = JSON.parse(response);
                                            return json.available ? "true" : "false";
                                        }
                                    }
                                },
                                phonenumber: {
                                    required: true,
                                    minlength: 11,
                                    remote: {
                                        url: '/check-phonenumber',
                                        type: 'POST',
                                        data: {
                                            phonenumber: function () {
                                                return $("#phonenumber").val();
                                            },
                                            uuid: function () {
                                                return $("#uuid").val(); // Adjust based on your UUID input
                                            }
                                        },
                                        dataType: 'json',
                                        async: true,
                                        dataFilter: function (response) {
                                            var json = JSON.parse(response);
                                            return json.available ? "true" : "false";
                                        }
                                    }
                                },
                            },
                            messages: {
                                agreement: {
                                    required: "Please check this box to proceed."
                                },
                                password: {
                                    required: "Please enter a password",
                                    minlength: "Your password must consist of at least 6 characters"
                                },
                                confirm_password: {
                                    required: "Please confirm your password",
                                    equalTo: "Passwords do not match"
                                },
                                firstname: {
                                    required: "Please enter your first name",
                                    minlength: "Your first name must consist of at least 2 characters"
                                },
                                middlename: {
                                    required: "Please enter your middle name",
                                    minlength: "Your middle name must consist of at least 2 characters"
                                },
                                lastname: {
                                    required: "Please enter your last name",
                                    minlength: "Your last name must consist of at least 2 characters"
                                },
                                gender: {
                                    required: "Please select your gender"
                                },
                                birthday: {
                                    required: "Please select your birthday",
                                    date: "Please enter a valid date"
                                },
                                username: {
                                    remote: "Username is already taken.",
                                    required: "Please enter your username",
                                },
                                email: {
                                    remote: "Email is already taken.",
                                    required: "Please enter your email address",
                                },
                                phonenumber: {
                                    required: "Please enter your phone number",
                                    minlength: "Please enter a valid phone number",
                                    remote: "Phone number is already taken."
                                },

                                errorPlacement: function (error, element) {
                                    // Custom placement for the password error
                                    if (element.attr("name") == "password") {
                                        error.appendTo(element.closest('.mb-3').find('.error-message'));
                                    } else {
                                        error.insertAfter(element);
                                    }
                                }


                            },
                            submitHandler: function (form) {
                                const submitButton = document.getElementById('submit-button');
                                const spinner = submitButton.querySelector('.spinner-border');

                                // Show spinner and disable button
                                spinner.style.display = 'inline-block';
                                submitButton.disabled = true;

                                const formData = new FormData(form); // Collect form data
                                fetch('/signup', {
                                    method: 'POST',
                                    body: formData,
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Hide spinner and enable button
                                        spinner.style.display = 'none';
                                        submitButton.disabled = false;

                                        if (data.success) {
                                            $.notify({
                                                icon: 'fa fa-check me-1',
                                                message: data.msg
                                            }, {
                                                type: 'success', allow_dismiss: false,
                                            });
                                            setTimeout(() => {
                                                window.location.href = '/signin';
                                            }, 3000);
                                        } else {
                                            $.notify({
                                                icon: 'fa fa-exclamation-triangle me-1',
                                                message: data.msg
                                            }, {
                                                type: 'danger', allow_dismiss: false,
                                            });
                                        }
                                    })
                                    .catch(error => {
                                        // Hide spinner and enable button
                                        spinner.style.display = 'none';
                                        submitButton.disabled = false;

                                        $.notify({
                                            icon: 'fa fa-times-circle me-1',
                                            message: 'An error occurred. Please try again.'
                                        }, {
                                            type: 'danger'
                                        });
                                        console.error('Error:', error);
                                    });
                            }

                        });
                    }

                    static init() {
                        this.initValidation();
                    }
                }

                // Call init function on document ready
                $(document).ready(() => e.init());
            })();
        </script>

        <script src="/assets/js/plugins/bootstrap-notify/bootstrap-notify.min.js"></script>
        <!-- App js -->
        <script src="assets/js/app.min.js"></script>
</body>

</html>